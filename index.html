<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workout Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
            min-height: 100vh;
            padding: 1rem;
            color: #e5e5e5;
        }

        .container {
            max-width: 1024px;
            margin: 0 auto;
        }

        .card {
            background: #1f1f1f;
            border-radius: 1rem;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            border: 1px solid #404040;
            overflow: hidden;
        }

        .header {
            padding: 2rem;
            border-bottom: 1px solid #404040;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            background: linear-gradient(135deg, #262626 0%, #1f1f1f 100%);
        }

        .header-icon {
            width: 2rem;
            height: 2rem;
            color: #ea580c;
        }

        .header h1 {
            font-size: 1.875rem;
            font-weight: 700;
            color: #f5f5f5;
        }

        .tabs {
            display: flex;
            border-bottom: 1px solid #404040;
        }

        .tab {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 1rem 1.5rem;
            background: none;
            border: none;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #a3a3a3;
            border-bottom: 2px solid transparent;
        }

        .tab:hover {
            color: #d4d4d4;
            background: rgba(64, 64, 64, 0.3);
        }

        .tab.active {
            background: rgba(234, 88, 12, 0.1);
            color: #fb923c;
            border-bottom-color: #ea580c;
        }

        .tab svg {
            width: 1.25rem;
            height: 1.25rem;
        }

        .content {
            padding: 2rem;
        }

        .alert {
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .alert-success {
            background: rgba(67, 20, 7, 0.5);
            border: 1px solid #9a3412;
            color: #fb923c;
        }

        .alert-error {
            background: rgba(127, 29, 29, 0.5);
            border: 1px solid #991b1b;
            color: #fca5a5;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #d4d4d4;
            margin-bottom: 0.5rem;
        }

        input, select {
            width: 100%;
            padding: 0.625rem 1rem;
            background: #404040;
            border: 1px solid #525252;
            color: #f5f5f5;
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: all 0.2s ease;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23fb923c' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1.25rem;
            padding-right: 2.5rem;
        }
        
        select option {
            background: #404040;
            color: #f5f5f5;
            padding: 0.5rem;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #ea580c;
            box-shadow: 0 0 0 3px rgba(234, 88, 12, 0.2);
        }

        input::placeholder {
            color: #737373;
        }

        .sets-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-add {
            background: rgba(234, 88, 12, 0.2);
            color: #fb923c;
            border: 1px solid rgba(234, 88, 12, 0.3);
        }

        .btn-add:hover {
            background: rgba(234, 88, 12, 0.3);
        }

        .btn-primary {
            width: 100%;
            padding: 0.75rem 1.5rem;
            background: #ea580c;
            color: white;
            font-size: 1rem;
            box-shadow: 0 10px 25px rgba(234, 88, 12, 0.2);
        }

        .btn-primary:hover:not(:disabled) {
            background: #c2410c;
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .set-row {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: rgba(64, 64, 64, 0.3);
            border-radius: 0.5rem;
            border: 1px solid #525252;
            margin-bottom: 0.75rem;
        }

        .set-label {
            font-size: 0.875rem;
            font-weight: 500;
            color: #fb923c;
            min-width: 3rem;
        }

        .set-row input {
            flex: 1;
            padding: 0.5rem 0.75rem;
        }

        .btn-delete {
            padding: 0.5rem;
            background: none;
            border: none;
            color: #f87171;
            cursor: pointer;
            border-radius: 0.5rem;
            transition: all 0.2s ease;
        }

        .btn-delete:hover {
            background: rgba(127, 29, 29, 0.3);
        }

        .btn-delete svg {
            width: 1.25rem;
            height: 1.25rem;
        }

        .loading, .empty {
            text-align: center;
            padding: 3rem;
            color: #a3a3a3;
        }

        .week-block {
            background: rgba(64, 64, 64, 0.2);
            border-radius: 0.5rem;
            padding: 1.25rem;
            border: 1px solid #525252;
            margin-bottom: 1.5rem;
        }

        .week-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #fb923c;
            margin-bottom: 1rem;
        }

        .day-block {
            background: #262626;
            border-radius: 0.5rem;
            padding: 1rem;
            border: 1px solid #525252;
            margin-bottom: 1rem;
        }

        .day-title {
            font-size: 1rem;
            font-weight: 600;
            color: #f5f5f5;
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #525252;
        }

        .workout-item {
            background: rgba(64, 64, 64, 0.3);
            border-radius: 0.375rem;
            padding: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .workout-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 0.5rem;
        }

        .workout-category {
            color: #fb923c;
            font-weight: 500;
        }

        .workout-exercise {
            color: #e5e5e5;
        }

        .workout-details {
            font-size: 0.875rem;
            color: #a3a3a3;
        }

        .setup-instructions {
            margin-top: 1.5rem;
            padding: 1rem;
            background: #1f1f1f;
            border: 1px solid #404040;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            color: #a3a3a3;
        }

        .setup-instructions p {
            font-weight: 500;
            color: #d4d4d4;
            margin-bottom: 0.5rem;
        }

        .setup-instructions ol {
            margin-left: 1.25rem;
        }

        .setup-instructions li {
            margin-bottom: 0.25rem;
        }

        .hidden {
            display: none;
        }

        svg {
            fill: none;
            stroke: currentColor;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        @media (max-width: 768px) {
            .header {
                padding: 1.5rem;
            }
            .header h1 {
                font-size: 1.5rem;
            }
            .content {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="header">
                <svg class="header-icon" viewBox="0 0 24 24">
                    <path d="M6.5 6.5v11M17.5 6.5v11M3 8.5h4M17 8.5h4M14.5 6.5h2M7.5 6.5h2M14.5 17.5h2M7.5 17.5h2"></path>
                </svg>
                <h1>Workout Tracker</h1>
            </div>

            <div class="tabs">
                <button class="tab active" onclick="switchTab('log')">
                    <svg viewBox="0 0 24 24">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    Log Workout
                </button>
                <button class="tab" onclick="switchTab('history')">
                    <svg viewBox="0 0 24 24">
                        <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                        <polyline points="17 6 23 6 23 12"></polyline>
                    </svg>
                    History
                </button>
            </div>

            <div id="logContent" class="content">
                <div id="successAlert" class="alert alert-success hidden">
                    <svg width="20" height="20" viewBox="0 0 24 24">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                        <polyline points="22 4 12 14.01 9 11.01"></polyline>
                    </svg>
                    <span>Workout saved successfully!</span>
                </div>

                <div id="errorAlert" class="alert alert-error hidden">
                    Please fill in all required fields (category, exercise and reps)
                </div>

                <div class="form-group">
                    <label>Date</label>
                    <input type="date" id="workoutDate">
                </div>

                <div class="form-group">
                    <label>Muscle Group</label>
                    <select id="categorySelect" onchange="updateExercises()">
                        <option value="">Select muscle group</option>
                    </select>
                </div>

                <div class="form-group" id="exerciseGroup" style="display: none;">
                    <label>Exercise</label>
                    <select id="exerciseSelect">
                        <option value="">Select an exercise</option>
                    </select>
                </div>

                <div class="form-group">
                    <div class="sets-header">
                        <label>Sets</label>
                        <button class="btn btn-add" onclick="addSet()">
                            <svg width="16" height="16" viewBox="0 0 24 24">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            Add Set
                        </button>
                    </div>
                    <div id="setsContainer"></div>
                </div>

                <button class="btn btn-primary" onclick="saveWorkout()">
                    <svg width="20" height="20" viewBox="0 0 24 24">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                        <polyline points="17 21 17 13 7 13 7 21"></polyline>
                        <polyline points="7 3 7 8 15 8"></polyline>
                    </svg>
                    Save Workout
                </button>
            </div>

            <div id="historyContent" class="content hidden">
                <div id="historyLoading" class="loading">Loading workout history...</div>
                <div id="historyEmpty" class="empty hidden">No workout history yet. Start logging your workouts!</div>
                <div id="historyData"></div>
            </div>
        </div>

        <div class="setup-instructions">
            <p>Setup Instructions:</p>
            <ol>
                <li>Create a Google Sheet for your workout data</li>
                <li>Go to Extensions → Apps Script in your Google Sheet</li>
                <li>Paste the provided Apps Script code</li>
                <li>Deploy as Web App and copy the URL</li>
                <li>Replace the APPS_SCRIPT_URL below in the script</li>
            </ol>
        </div>
    </div>

    <script>
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyjGq98jvDhQpOfjxDGWw1EKIRU31EZICp7p78_ns6QUI3OdzUevQBZYmWUgnkJzRlm/exec';

        const workoutCategories = {
            'Chest': ['Bench Press', 'Incline Bench Press', 'Decline Bench Press', 'Dumbbell Press', 'Incline Dumbbell Press', 'Chest Fly', 'Cable Fly', 'Push-ups', 'Dips'],
            'Back': ['Deadlift', 'Bent Over Row', 'T-Bar Row', 'Seated Cable Row', 'Lat Pulldown', 'Pull-ups', 'Chin-ups', 'Face Pulls', 'Shrugs'],
            'Shoulders': ['Overhead Press', 'Arnold Press', 'Lateral Raise', 'Front Raise', 'Rear Delt Fly', 'Upright Row', 'Face Pulls'],
            'Biceps': ['Barbell Curl', 'Dumbbell Curl', 'Hammer Curl', 'Preacher Curl', 'Concentration Curl', 'Cable Curl'],
            'Triceps': ['Tricep Dips', 'Close Grip Bench Press', 'Skull Crushers', 'Overhead Tricep Extension', 'Tricep Pushdown', 'Kickbacks'],
            'Legs': ['Squat', 'Front Squat', 'Leg Press', 'Lunges', 'Bulgarian Split Squat', 'Leg Extension', 'Leg Curl', 'Calf Raise'],
            'Core': ['Plank', 'Crunches', 'Russian Twists', 'Leg Raises', 'Mountain Climbers', 'Bicycle Crunches', 'Dead Bug'],
            'Cardio': ['Running', 'Cycling', 'Swimming', 'Jump Rope', 'Rowing', 'Elliptical', 'Stair Climber']
        };

        let sets = [{ reps: '', weight: '' }];
        let currentTab = 'log';

        // Initialize
        document.getElementById('workoutDate').valueAsDate = new Date();
        const categorySelect = document.getElementById('categorySelect');
        Object.keys(workoutCategories).forEach(category => {
            const option = document.createElement('option');
            option.value = category;
            option.textContent = category;
            categorySelect.appendChild(option);
        });
        renderSets();

        function switchTab(tab) {
            currentTab = tab;
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(t => t.classList.remove('active'));
            event.target.closest('.tab').classList.add('active');

            document.getElementById('logContent').classList.toggle('hidden', tab !== 'log');
            document.getElementById('historyContent').classList.toggle('hidden', tab !== 'history');

            if (tab === 'history') {
                fetchHistory();
            }
        }

        function updateExercises() {
            const category = document.getElementById('categorySelect').value;
            const exerciseGroup = document.getElementById('exerciseGroup');
            const exerciseSelect = document.getElementById('exerciseSelect');

            if (category) {
                exerciseGroup.style.display = 'block';
                exerciseSelect.innerHTML = '<option value="">Select an exercise</option>';
                workoutCategories[category].forEach(exercise => {
                    const option = document.createElement('option');
                    option.value = exercise;
                    option.textContent = exercise;
                    exerciseSelect.appendChild(option);
                });
            } else {
                exerciseGroup.style.display = 'none';
            }
        }

        function addSet() {
            sets.push({ reps: '', weight: '' });
            renderSets();
        }

        function removeSet(index) {
            if (sets.length > 1) {
                sets.splice(index, 1);
                renderSets();
            }
        }

        function updateSet(index, field, value) {
            sets[index][field] = value;
        }

        function renderSets() {
            const container = document.getElementById('setsContainer');
            container.innerHTML = '';
            
            sets.forEach((set, index) => {
                const setRow = document.createElement('div');
                setRow.className = 'set-row';
                setRow.innerHTML = `
                    <span class="set-label">Set ${index + 1}</span>
                    <input type="number" placeholder="Reps" value="${set.reps}" 
                           oninput="updateSet(${index}, 'reps', this.value)">
                    <input type="number" placeholder="Weight (kg/lbs)" value="${set.weight}"
                           oninput="updateSet(${index}, 'weight', this.value)">
                    ${sets.length > 1 ? `
                        <button class="btn-delete" onclick="removeSet(${index})">
                            <svg viewBox="0 0 24 24">
                                <polyline points="3 6 5 6 21 6"></polyline>
                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                            </svg>
                        </button>
                    ` : ''}
                `;
                container.appendChild(setRow);
            });
        }

        async function saveWorkout() {
            const date = document.getElementById('workoutDate').value;
            const category = document.getElementById('categorySelect').value;
            const exercise = document.getElementById('exerciseSelect').value;

            if (!category || !exercise || sets.some(s => !s.reps)) {
                showAlert('error');
                return;
            }

            const data = {
                date,
                category,
                exercise,
                sets: sets.map((s, i) => ({
                    setNumber: i + 1,
                    reps: s.reps,
                    weight: s.weight || '0'
                }))
            };

            try {
                await fetch(APPS_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                showAlert('success');
                document.getElementById('categorySelect').value = '';
                document.getElementById('exerciseSelect').value = '';
                document.getElementById('exerciseGroup').style.display = 'none';
                sets = [{ reps: '', weight: '' }];
                renderSets();
            } catch (error) {
                console.error('Error saving workout:', error);
                showAlert('error');
            }
        }

        function showAlert(type) {
            const successAlert = document.getElementById('successAlert');
            const errorAlert = document.getElementById('errorAlert');
            
            if (type === 'success') {
                successAlert.classList.remove('hidden');
                setTimeout(() => successAlert.classList.add('hidden'), 3000);
            } else {
                errorAlert.classList.remove('hidden');
                setTimeout(() => errorAlert.classList.add('hidden'), 2000);
            }
        }

        async function fetchHistory() {
            const loading = document.getElementById('historyLoading');
            const empty = document.getElementById('historyEmpty');
            const data = document.getElementById('historyData');
            
            loading.classList.remove('hidden');
            empty.classList.add('hidden');
            data.innerHTML = '';

            try {
                const response = await fetch(`${APPS_SCRIPT_URL}?action=getHistory`);
                const result = await response.json();
                
                loading.classList.add('hidden');
                
                if (result.status === 'success' && result.data && result.data.length > 0) {
                    renderHistory(result.data);
                } else {
                    empty.classList.remove('hidden');
                }
            } catch (error) {
                console.error('Error fetching history:', error);
                loading.classList.add('hidden');
                empty.classList.remove('hidden');
            }
        }

        function renderHistory(historyData) {
            const container = document.getElementById('historyData');
            const weeks = groupByWeek(historyData);
            
            Object.entries(weeks).sort((a, b) => new Date(b[0]) - new Date(a[0])).forEach(([weekStart, weekData]) => {
                const weekEnd = new Date(weekStart);
                weekEnd.setDate(weekEnd.getDate() + 6);
                
                const weekBlock = document.createElement('div');
                weekBlock.className = 'week-block';
                weekBlock.innerHTML = `
                    <h3 class="week-title">Week: ${new Date(weekStart).toLocaleDateString()} - ${weekEnd.toLocaleDateString()}</h3>
                    <div class="week-content"></div>
                `;
                
                const weekContent = weekBlock.querySelector('.week-content');
                const dates = groupByDate(weekData);
                
                Object.entries(dates).sort((a, b) => new Date(b[0]) - new Date(a[0])).forEach(([date, dayData]) => {
                    const dayBlock = document.createElement('div');
                    dayBlock.className = 'day-block';
                    
                    const dayTitle = document.createElement('h4');
                    dayTitle.className = 'day-title';
                    dayTitle.textContent = new Date(date).toLocaleDateString('en-US', { 
                        weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' 
                    });
                    dayBlock.appendChild(dayTitle);
                    
                    dayData.forEach(workout => {
                        const workoutItem = document.createElement('div');
                        workoutItem.className = 'workout-item';
                        workoutItem.innerHTML = `
                            <div class="workout-header">
                                <div>
                                    <span class="workout-category">${workout.category}</span>
                                    <span style="color: #a3a3a3; margin: 0 0.5rem;">•</span>
                                    <span class="workout-exercise">${workout.exercise}</span>
                                </div>
                            </div>
                            <div class="workout-details">
                                Set ${workout.setNumber}: ${workout.reps} reps ${workout.weight !== '0' ? `@ ${workout.weight} kg/lbs` : ''}
                            </div>
                        `;
                        dayBlock.appendChild(workoutItem);
                    });
                    
                    weekContent.appendChild(dayBlock);
                });
                
                container.appendChild(weekBlock);
            });
        }

        function groupByWeek(data) {
            const weeks = {};
            data.forEach(row => {
                const date = new Date(row.date);
                const weekStart = new Date(date);
                weekStart.setDate(date.getDate() - date.getDay());
                const weekKey = weekStart.toISOString().split('T')[0];
                
                if (!weeks[weekKey]) {
                    weeks[weekKey] = [];
                }
                weeks[weekKey].push(row);
            });
            return weeks;
        }

        function groupByDate(weekData) {
            const dates = {};
            weekData.forEach(row => {
                if (!dates[row.date]) {
                    dates[row.date] = [];
                }
                dates[row.date].push(row);
            });
            return dates;
        }
    </script>
</body>
</html>